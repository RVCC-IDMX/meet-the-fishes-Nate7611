<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scene Management</title>

    <!--

        First note what we're loading in.

        We could also do this the JavaScript Module route, but we'll learn about that later.

    -->
    <script src="https://pixijs.download/release/pixi.js"></script>
    <script src="js/bezier.js"></script>
    <script src="js/animate.js"></script>
    <script src="js/ui_elements.js"></script>
</head>

<body>

    <script type="module">

        //
        // Basic setup
        //

        //The App
        var app = new PIXI.Application();
        await app.init({
            width: 640,
            height: 480,
            backgroundColor: 0x127560
        });
        var stage = app.stage;
        var view = app.canvas;

        //Add view to the document
        document.body.appendChild(app.canvas);

        await PIXI.Assets.load("img/fish1.png");
        await PIXI.Assets.load("img/fish2.png");
        await PIXI.Assets.load("img/fish3.png");

        /*
            Depending on the system or context, these can be called "scenes" "views" "pages" "panels" or all sorts of other things.
    
            The important bit is that they are each a grouping or state of different interface elements that need to be on the screen at different times.
    
            We'll call them "scenes" – if only because they're going up onto the Pixi.js stage object when we need them.
        */

        //
        // Let's create a few really boring scenes using Pixi.js Containers
        //

        //SCENE 1
        let scene1 = new PIXI.Container();

        //Using our button object let's create a "next" button.
        let nextButton1 = UI.Button(0, 0, "Next >");

        //Let's place it in the bottom right-hand corner of the screen (regardless of size)
        nextButton1.x = app.canvas.width - nextButton1.width - 10;
        nextButton1.y = app.canvas.height - nextButton1.height - 10;

        //And place it into the scene
        scene1.addChild(nextButton1);

        //And let's add some text to tell us which scene we're on
        let scene1Text = new PIXI.Text("My Fish", {
            fill: 0xFFFFFF,
            fontSize: 125,
            align: 'center',
            fontWeight: 'bold',
            stroke: { color: 0x127560, width: 6, join: 'round' },
            dropShadow: {
                color: '#000000',
                blur: 5,
                distance: 7,
            },
        });
        scene1Text.anchor.set(0.5);

        scene1Text.x = app.screen.width / 2;
        scene1Text.y = app.screen.height / 2;

        //And place it into the scene
        scene1.addChild(scene1Text);


        //SCENE 2
        let scene2 = new PIXI.Container();

        //Using our button object let's create a "next" button.
        let backButton1 = UI.Button(0, 0, "< Back");

        let nextButton2 = UI.Button(0, 0, "Next >");

        //Let's place it in the bottom right-hand corner of the screen (regardless of size)
        nextButton2.x = app.canvas.width - nextButton2.width - 10;
        nextButton2.y = app.canvas.height - nextButton2.height - 10;

        //And place it into the scene
        scene2.addChild(nextButton2);

        //Let's place it in the bottom left-hand corner of the screen (regardless of size)
        backButton1.x = 0 + 10;
        backButton1.y = app.canvas.height - backButton1.height - 10;

        //And place it into the scene
        scene2.addChild(backButton1);

        //And let's also add some text to tell us which scene we're on
        let scene2Text = new PIXI.Text("Mahi-Mahi", {
            fill: 0xFFFFFF,
            fontSize: 88,
            align: 'center',
            fontWeight: 'bold',
            stroke: { color: '#CBAB4D', width: 6, join: 'round' },
            dropShadow: {
                color: '#000000',
                blur: 5,
                distance: 7,
            },
        });
        scene2Text.anchor.set(0.5);

        scene2Text.x = app.screen.width / 2;
        scene2Text.y = 60;

        //And place it into the scene
        scene2.addChild(scene2Text);

        let fish1 = PIXI.Sprite.from("img/fish1.png");
        fish1.anchor.set(0.5);
        fish1.scale.set(0.2);
        fish1.x = app.canvas.width / 2;
        fish1.y = app.canvas.height / 2.5;

        scene2.addChild(fish1);

        //SCENE 3
        let scene3 = new PIXI.Container();

        //Using our button object let's create a "next" button.
        let backButton2 = UI.Button(0, 0, "< Back");

        let nextButton3 = UI.Button(0, 0, "Next >");

        //Let's place it in the bottom right-hand corner of the screen (regardless of size)
        nextButton3.x = app.canvas.width - nextButton3.width - 10;
        nextButton3.y = app.canvas.height - nextButton3.height - 10;

        //And place it into the scene
        scene3.addChild(nextButton3);

        //Let's place it in the bottom left-hand corner of the screen (regardless of size)
        backButton2.x = 0 + 10;
        backButton2.y = app.canvas.height - backButton2.height - 10;

        //And place it into the scene
        scene3.addChild(backButton2);

        //And let's also add some text to tell us which scene we're on
        let scene3Text = new PIXI.Text("Yellow Tang", {
            fill: 0xFFFFFF,
            fontSize: 88,
            align: 'center',
            fontWeight: 'bold',
            stroke: { color: '#738D06', width: 6, join: 'round' },
            dropShadow: {
                color: '#000000',
                blur: 5,
                distance: 10,
            },
        });
        scene3Text.skew.set(0.2, -0.1);
        scene3Text.anchor.set(0.5);

        scene3Text.x = app.screen.width / 2;
        scene3Text.y = 60;

        //And place it into the scene
        scene3.addChild(scene3Text);

        let fish2 = PIXI.Sprite.from("img/fish2.png");
        fish2.anchor.set(0.5);
        fish2.scale.y = 0.1;
        fish2.scale.x = -0.1;
        fish2.x = app.canvas.width / 2;
        fish2.y = app.canvas.height / 2.5;

        scene3.addChild(fish2);

        //SCENE 4
        let scene4 = new PIXI.Container();

        let backButton3 = UI.Button(0, 0, "< Back");
        let nextButton4 = UI.Button(0, 0, "Next >");

        //Let's place it in the bottom right-hand corner of the screen (regardless of size)
        nextButton4.x = app.canvas.width - nextButton4.width - 10;
        nextButton4.y = app.canvas.height - nextButton4.height - 10;

        //And place it into the scene
        scene4.addChild(nextButton4);

        //Let's place it in the bottom left-hand corner of the screen (regardless of size)
        backButton3.x = 0 + 10;
        backButton3.y = app.canvas.height - backButton3.height - 10;

        //And place it into the scene
        scene4.addChild(backButton3);

        //And let's also add some text to tell us which scene we're on
        let scene4Text = new PIXI.Text("Fathead Minnow", {
            fontSize: 70,
            align: 'center',
            fill: 0xFFFFFF,
            fontWeight: 'bold',
            stroke: { color: '#756B48', width: 6, join: 'round' },
            dropShadow: {
                color: '#000000',
                blur: 5,
                distance: 7,
            },
        });
        scene4Text.anchor.set(0.5);

        scene4Text.x = app.screen.width / 2;
        scene4Text.y = 60;

        //And place it into the scene
        scene4.addChild(scene4Text);

        let fish3 = PIXI.Sprite.from("img/fish3.png");
        fish3.anchor.set(0.5);
        fish3.scale.set(0.5);
        fish3.x = app.canvas.width / 2;
        fish3.y = app.canvas.height / 2.5;

        scene4.addChild(fish3);

        //SCENE 5
        let scene5 = new PIXI.Container();

        let backButton4 = UI.Button(0, 0, "< Back");

        backButton4.x = 0 + 10;
        backButton4.y = app.canvas.height - backButton4.height - 10;

        //And place it into the scene
        scene5.addChild(backButton4);

        //And let's add some text to tell us which scene we're on
        let scene5Text = new PIXI.Text("The End", {
            fill: 0xFFFFFF,
            fontSize: 125,
            align: 'center',
            fontWeight: 'bold',
            stroke: { color: 0x127560, width: 6, join: 'round' },
            dropShadow: {
                color: '#000000',
                blur: 5,
                distance: 7,
            },
        });
        scene5Text.anchor.set(0.5);

        scene5Text.x = app.screen.width / 2;
        scene5Text.y = app.screen.height / 2;

        //And place it into the scene
        scene5.addChild(scene5Text);


        //Now let's add the first scene to the stage
        app.stage.addChild(scene1);

        //Let's call it the Director. It calls the shots.
        var Director = {

            //It holds a list of scenes
            scene: {},

            //Add a scene to the list
            addScene: (name, scene) => {

                //If it exists throw an error
                if (Director.scene[name])
                    throw "That scene already exists!"

                //Otherwise add it
                Director.scene[name] = scene;

                //If it's the first scene, make it the active one
                if (Director.currentScene == null)
                    Director.currentScene = name;

            },

            //And it keeps track of the current one
            currentScene: null,

            //And a function to change scenes
            showScene: async (nextSceneName, params) => {

                if (params == undefined) params = {};

                let currentScene = Director.scene[Director.currentScene];
                let nextScene = Director.scene[nextSceneName];

                if (params.transition == undefined)
                    params.transition = Director.cut;

                await params.transition(currentScene, nextScene, params);

                Director.currentScene = nextSceneName;

            },

            //
            //Transitions
            //

            //Cut (no transition)
            cut: async (currentScene, nextScene, params) => {
                app.stage.removeChild(currentScene);
                app.stage.addChild(nextScene);
            },

            //Fade between
            fade: async (currentScene, nextScene, params) => {

                //Check duration
                if (params == undefined) params = {};
                if (params.duration == undefined) params.duration = 500;

                //Fade out current scene
                await Animate.to(currentScene, { alpha: 0, duration: params.duration / 2 });
                //Remove it from stage
                app.stage.removeChild(currentScene);
                //Set next scene to zero alpha
                nextScene.alpha = 0;
                //Add it to the stage
                app.stage.addChild(nextScene);
                //Fade it in
                await Animate.to(nextScene, { alpha: 1, duration: params.duration / 2 });
                //Reset the off-stage scene's alpha back
                currentScene.alpha = 1;
            },

            //Slide in a particular direction
            swipe: async (currentScene, nextScene, params) => {
                console.log(params.direction);
                //Set up destinations
                let currentSceneEndX, currentSceneEndY;
                let nextSceneStartX, nextSceneStartY;

                //Check duration
                if (params == undefined) params = {};
                if (params.duration == undefined) params.duration = 500;

                //Set default direction
                if (params.direction == undefined) params.direction = "left";

                //Figure out initial and end positions
                if (params.direction == "left") {
                    currentSceneEndX = -app.canvas.width;
                    currentSceneEndY = 0;
                    nextSceneStartX = app.canvas.width;
                    nextSceneStartY = 0;
                }
                else if (params.direction == "right") {
                    currentSceneEndX = app.canvas.width;
                    currentSceneEndY = 0;
                    nextSceneStartX = -app.canvas.width;
                    nextSceneStartY = 0;
                }
                else if (params.direction == "up") {
                    currentSceneEndX = 0;
                    currentSceneEndY = -app.canvas.height;
                    nextSceneStartX = 0;
                    nextSceneStartY = app.canvas.height;
                }
                else if (params.direction == "down") {
                    currentSceneEndX = 0;
                    currentSceneEndY = app.canvas.height;
                    nextSceneStartX = 0;
                    nextSceneStartY = -app.canvas.height;
                }

                //Set up next scene
                nextScene.x = nextSceneStartX;
                nextScene.y = nextSceneStartY;
                app.stage.addChild(nextScene);

                //Slide out current scene as it moves off
                Animate.to(currentScene, {
                    x: currentSceneEndX, y: currentSceneEndY,
                    duration: params.duration,
                    easing: Animate.easeInOut
                });
                //WHILE bringing in the next scene
                await Animate.to(nextScene, {
                    x: 0, y: 0,
                    duration: params.duration,
                    easing: Animate.easeInOut
                });
                //We only "await" on the last animation, so that they both move at the same time

                //Remove the old scene from stage
                app.stage.removeChild(currentScene);

                //And just to be nice, move the old scene back to neutral
                currentScene.x = 0;
                currentScene.y = 0;

            },

            zoom: async (currentScene, nextScene, params) => {
                currentScene.scale = 1;
                nextScene.scale = 0;

                app.stage.addChild(nextScene);

                await Animate.to(currentScene, {
                    scale: { x: 0.5, y: 0 },
                    duration: params.duration || 500,
                    easing: Animate.easeInOut
                });

                await Animate.to(nextScene, {
                    scale: { x: 1, y: 1 },
                    duration: params.duration || 500,
                    easing: Animate.easeInOut
                });

                app.stage.removeChild(currentScene);

                currentScene.scale = 1;
            },

        };

        Director.addScene("first", scene1);
        Director.addScene("second", scene2);
        Director.addScene("third", scene3);
        Director.addScene("fourth", scene4);
        Director.addScene("fifth", scene5);

        nextButton1.onclick = () => {
            Director.showScene("second", { transition: Director.swipe });
        };

        nextButton2.onclick = () => {
            Director.showScene("third", { transition: Director.zoom });
        };

        nextButton3.onclick = () => {
            Director.showScene("fourth", { transition: Director.fade });
        };

        nextButton4.onclick = () => {
            Director.showScene("fifth", { transition: Director.swipe });
        };

        backButton1.onclick = () => {
            Director.showScene("first", { transition: Director.swipe, direction: "down" });
        };

        backButton2.onclick = () => {
            Director.showScene("second", { transition: Director.zoom });
        };

        backButton3.onclick = () => {
            Director.showScene("third", { transition: Director.fade });
        };

        backButton4.onclick = () => {
            Director.showScene("fourth", { transition: Director.swipe, direction: "down" });
        };



        async function fish1Loop() {
            await Animate.to(fish1, {
                y: fish1.y - (50),
                duration: (500),
                rotation: 0.05,
                easing: Animate.easeOut
            });
            await Animate.to(fish1, {
                y: fish1.y + (100),
                duration: (1000),
                rotation: -0.05,
                easing: Animate.easeInOut
            });
            await Animate.to(fish1, {
                y: fish1.y - (50),
                duration: (500),
                rotation: 0,
                easing: Animate.easeIn
            });
            requestAnimationFrame(fish1Loop);
        }

        fish1Loop();

        async function fish2Loop() {
            await Animate.to(fish2, {
                x: app.canvas.width + 200,
                duration: (2000),
                easing: Animate.linear
            });
            fish2.x = -200;
            requestAnimationFrame(fish2Loop);
        }

        fish2Loop();

        let originalPos = fish3.y;
        async function fish3Loop() {
            await Animate.to(fish3, {
                y: originalPos + 85,
                duration: (1000),
                scale: {
                    x: -0.5,
                    y: 0.5
                },
                easing: Animate.easeIn
            });
            await Animate.to(fish3, {
                y: originalPos - 85,
                duration: (1000),
                scale: {
                    x: 0.6,
                    y: 0.6
                },
                easing: Animate.easeOut
            });
            requestAnimationFrame(fish3Loop);
        }

        fish3Loop();

        /*
            This week's homework!
    
            Accept the assignment invite for Meet The Fish (when it goes up).
    
            Put together a multi-scened presentation to show off fictional profiles of 3 of *your* fish. (Replace the ones in the images folder here.)
    
            (Read up on the Graphics and Text display objects here:)
            
                https://pixijs.download/dev/docs/PIXI.Graphics.html
                https://pixijs.download/dev/docs/PIXI.Text.html
            
            (They will help.)
            
            Each fish should be animated on their profile page in their own unique way.
            
            There should be – at least – a title screen, and one screen for each fish but bonus points for adding on more.
    
            Add to the button system so that the buttons look more aesthetic.
    
            Add in a new transition of your choice and implement it on one of your transitions.
    
        */

    </script>

</body>

</html>